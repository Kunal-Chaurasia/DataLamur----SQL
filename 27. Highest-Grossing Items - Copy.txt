select category, product, total_spend from (
select category, product, sum(spend) as total_spend,
rank() over (partition by category order by sum(spend) desc) as ranking
FROM product_spend
where extract(year from transaction_date) = 2022
group by category, product) as ranked_spending
where ranking <=2
order by category, ranking